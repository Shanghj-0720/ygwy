<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>工作报告详情 - AI业委会</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="../../assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        'primary-light': '#4080FF',
                        'primary-dark': '#0F4CD3',
                        secondary: '#2D5CF6',
                        accent: '#00B96B',
                        neutral: '#F5F7FA',
                        'neutral-light': '#FAFBFC',
                        dark: '#1D2129',
                        light: '#86909C',
                        border: '#E5E6EB',
                        success: '#00B96B',
                        warning: '#FF7D00',
                        purple: '#8B5CF6',
                    }
                }
            }
        }
    </script>
    <style>
        .article-content h2 {
            font-size: 1.125rem;
            font-weight: bold;
            color: #1D2129;
            margin: 1.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #165DFF;
        }
        .article-content h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #1D2129;
            margin: 1.25rem 0 0.75rem;
        }
        .article-content p {
            color: #4E5969;
            line-height: 1.75;
            margin-bottom: 0.75rem;
        }
        .article-content ul {
            list-style: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }
        .article-content li {
            color: #4E5969;
            line-height: 1.75;
            margin-bottom: 0.5rem;
        }
        .stat-card {
            background: linear-gradient(135deg, #F0F4FF 0%, #E8F0FE 100%);
            border-left: 4px solid #165DFF;
        }
        .catalog-item {
            cursor: pointer;
            transition: all 0.2s;
        }
        .catalog-item:hover {
            background: #F5F7FA;
            transform: translateX(4px);
        }
        .catalog-item.active {
            background: rgba(22, 93, 255, 0.1);
            color: #165DFF;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-neutral-light">
    <!-- 头部 -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="flex items-center justify-between px-4 py-3">
            <button onclick="history.back()" class="w-8 h-8 flex items-center justify-center">
                <i class="fa fa-arrow-left text-dark text-lg"></i>
            </button>
            <h1 class="text-base font-bold text-dark flex-1 text-center px-2">工作报告详情</h1>
            <div class="flex items-center gap-2">
                <button onclick="shareReport()" class="w-8 h-8 flex items-center justify-center text-light hover:text-primary">
                    <i class="fa fa-share-alt"></i>
                </button>
                <button onclick="downloadReport()" class="w-8 h-8 flex items-center justify-center text-light hover:text-primary">
                    <i class="fa fa-download"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容 -->
    <main class="container mx-auto px-4 py-4 pb-20">
        <!-- 报告头部 -->
        <div class="bg-white rounded-xl p-4 mb-4 shadow-sm">
            <div class="flex items-center gap-2 mb-3">
                <span class="text-xs bg-primary/10 text-primary px-2 py-1 rounded-full font-medium">业委会工作报告</span>
                <span class="text-xs bg-success/10 text-success px-2 py-1 rounded-full font-medium">
                    <i class="fa fa-eye"></i> 已读 326
                </span>
            </div>

            <h1 class="text-xl font-bold text-dark mb-3">2025年第四季度业委会工作报告</h1>

            <div class="flex items-center gap-4 text-xs text-light mb-4">
                <div class="flex items-center gap-1">
                    <i class="fa fa-user"></i>
                    <span>发布人：业委会</span>
                </div>
                <div class="flex items-center gap-1">
                    <i class="fa fa-calendar"></i>
                    <span>2025-12-01</span>
                </div>
            </div>

            <!-- 关键数据摘要 -->
            <div class="grid grid-cols-2 gap-3">
                <div class="stat-card rounded-lg p-3">
                    <p class="text-xs text-light mb-1">维修基金使用</p>
                    <p class="text-lg font-bold text-primary">¥ 8.5万</p>
                </div>
                <div class="stat-card rounded-lg p-3" style="background: linear-gradient(135deg, #F0FFF4 0%, #E8F5E9 100%); border-left-color: #00B96B;">
                    <p class="text-xs text-light mb-1">业主满意度</p>
                    <p class="text-lg font-bold text-success">89%</p>
                </div>
            </div>
        </div>

        <!-- 目录导航 -->
        <div class="bg-white rounded-xl p-4 mb-4">
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-base font-bold text-dark flex items-center gap-2">
                    <i class="fa fa-list-ul text-primary"></i>
                    报告目录
                </h3>
                <button onclick="toggleCatalog()" class="text-xs text-primary">
                    <span id="catalog-toggle">收起</span> <i class="fa fa-angle-up" id="catalog-icon"></i>
                </button>
            </div>

            <div id="catalog-content" class="space-y-1">
                <div class="catalog-item active p-2 rounded-lg text-sm" onclick="scrollToSection('section1')">
                    一、本季度工作概述
                </div>
                <div class="catalog-item p-2 rounded-lg text-sm text-light" onclick="scrollToSection('section2')">
                    二、维修基金使用情况
                </div>
                <div class="catalog-item p-2 rounded-lg text-sm text-light" onclick="scrollToSection('section3')">
                    三、业主满意度调查
                </div>
                <div class="catalog-item p-2 rounded-lg text-sm text-light" onclick="scrollToSection('section4')">
                    四、物业服务监督
                </div>
                <div class="catalog-item p-2 rounded-lg text-sm text-light" onclick="scrollToSection('section5')">
                    五、公共收益管理
                </div>
                <div class="catalog-item p-2 rounded-lg text-sm text-light" onclick="scrollToSection('section6')">
                    六、下季度工作计划
                </div>
            </div>
        </div>

        <!-- 报告正文 -->
        <div class="bg-white rounded-xl p-4 mb-4">
            <div class="article-content text-sm">
                <section id="section1">
                    <h2>一、本季度工作概述</h2>
                    <p>
                        2025年第四季度，业委会在全体业主的支持下，紧紧围绕"提升服务质量、优化小区环境、维护业主权益"的工作目标，扎实开展各项工作。本季度共召开业委会会议6次，处理业主诉求82件，组织开展业主大会1次，取得了显著成效。
                    </p>

                    <h3>主要工作成果</h3>
                    <ul>
                        <li>完成小区外墙防水维修工程，解决了困扰业主多年的渗漏问题</li>
                        <li>推动物业公司提升服务质量，业主满意度从86%提升至89%</li>
                        <li>规范公共收益管理，本季度公共收益达15.2万元，同比增长8%</li>
                        <li>协调处理邻里纠纷12起，调解成功率达100%</li>
                        <li>组织消防安全演练2次，参与业主超过200户</li>
                    </ul>
                </section>

                <section id="section2">
                    <h2>二、维修基金使用情况</h2>
                    <p>
                        本季度维修基金使用严格按照《住宅专项维修资金管理办法》执行，所有项目均经过业主大会表决通过。
                    </p>

                    <h3>维修项目明细</h3>
                    <div class="bg-neutral-light rounded-lg p-3 mb-3">
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between items-start pb-3 border-b border-border">
                                <div>
                                    <p class="font-medium text-dark mb-1">小区外墙防水维修</p>
                                    <p class="text-xs text-light">实施时间：2025年10月</p>
                                </div>
                                <span class="font-bold text-dark">¥ 8.5万</span>
                            </div>
                            <div class="flex justify-between items-start pb-3 border-b border-border">
                                <div>
                                    <p class="font-medium text-dark mb-1">消防设施维护保养</p>
                                    <p class="text-xs text-light">实施时间：2025年11月</p>
                                </div>
                                <span class="font-bold text-dark">¥ 4.2万</span>
                            </div>
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-medium text-dark mb-1">公共区域照明升级</p>
                                    <p class="text-xs text-light">实施时间：2025年9月</p>
                                </div>
                                <span class="font-bold text-dark">¥ 6.8万</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <div class="flex items-start gap-2">
                            <i class="fa fa-info-circle text-primary mt-0.5"></i>
                            <div class="flex-1">
                                <p class="text-xs font-medium text-dark mb-1">资金使用说明</p>
                                <p class="text-xs text-dark">
                                    本季度维修基金使用总额19.5万元，占基金总额的12.3%。所有项目均已完工验收，相关票据已公示在小区公告栏。
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="section3">
                    <h2>三、业主满意度调查</h2>
                    <p>
                        本季度我们通过线上问卷和入户走访相结合的方式，开展了业主满意度调查，共收到有效问卷612份，覆盖率达71.5%。
                    </p>

                    <h3>满意度统计</h3>
                    <div class="grid grid-cols-2 gap-3 mb-3">
                        <div class="border border-border rounded-lg p-3">
                            <p class="text-xs text-light mb-1">物业服务</p>
                            <div class="flex items-end gap-2">
                                <span class="text-2xl font-bold text-primary">87%</span>
                                <span class="text-xs text-success mb-1">↑ 2%</span>
                            </div>
                        </div>
                        <div class="border border-border rounded-lg p-3">
                            <p class="text-xs text-light mb-1">环境卫生</p>
                            <div class="flex items-end gap-2">
                                <span class="text-2xl font-bold text-success">92%</span>
                                <span class="text-xs text-success mb-1">↑ 4%</span>
                            </div>
                        </div>
                        <div class="border border-border rounded-lg p-3">
                            <p class="text-xs text-light mb-1">安保服务</p>
                            <div class="flex items-end gap-2">
                                <span class="text-2xl font-bold text-warning">85%</span>
                                <span class="text-xs text-success mb-1">↑ 3%</span>
                            </div>
                        </div>
                        <div class="border border-border rounded-lg p-3">
                            <p class="text-xs text-light mb-1">设施维护</p>
                            <div class="flex items-end gap-2">
                                <span class="text-2xl font-bold text-purple">90%</span>
                                <span class="text-xs text-success mb-1">↑ 5%</span>
                            </div>
                        </div>
                    </div>

                    <h3>改进措施</h3>
                    <p>
                        针对业主反映的问题，业委会已督促物业公司制定整改方案：
                    </p>
                    <ul>
                        <li>增加保洁人员，提高公共区域清洁频次</li>
                        <li>加强门禁管理，完善外来人员登记制度</li>
                        <li>定期维护电梯设备，确保运行安全</li>
                        <li>优化停车管理，缓解停车难问题</li>
                    </ul>
                </section>

                <section id="section4">
                    <h2>四、物业服务监督</h2>
                    <p>
                        业委会持续加强对物业公司的监督，确保物业服务质量。本季度开展专项检查8次，发现并督促整改问题23项。
                    </p>

                    <h3>检查情况</h3>
                    <div class="space-y-2 mb-3">
                        <div class="bg-neutral-light rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-dark">环境卫生检查</span>
                                <span class="text-xs bg-success/10 text-success px-2 py-0.5 rounded-full">优秀</span>
                            </div>
                            <p class="text-xs text-light">公共区域清洁及时，绿化养护到位</p>
                        </div>
                        <div class="bg-neutral-light rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-dark">安保巡逻检查</span>
                                <span class="text-xs bg-warning/10 text-warning px-2 py-0.5 rounded-full">良好</span>
                            </div>
                            <p class="text-xs text-light">夜间巡逻需加强，门禁管理待改进</p>
                        </div>
                        <div class="bg-neutral-light rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-dark">设施设备检查</span>
                                <span class="text-xs bg-success/10 text-success px-2 py-0.5 rounded-full">优秀</span>
                            </div>
                            <p class="text-xs text-light">电梯、消防等设施运行正常</p>
                        </div>
                    </div>
                </section>

                <section id="section5">
                    <h2>五、公共收益管理</h2>
                    <p>
                        本季度公共收益管理规范透明，所有收入支出均在业主群和公告栏公示。
                    </p>

                    <h3>收益明细</h3>
                    <div class="bg-neutral-light rounded-lg p-3 mb-3">
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between pb-2 border-b border-border">
                                <span class="text-light">广告位出租收入</span>
                                <span class="font-medium text-dark">¥ 8.2万</span>
                            </div>
                            <div class="flex justify-between pb-2 border-b border-border">
                                <span class="text-light">停车位收入</span>
                                <span class="font-medium text-dark">¥ 4.5万</span>
                            </div>
                            <div class="flex justify-between pb-2 border-b border-border">
                                <span class="text-light">快递柜租赁收入</span>
                                <span class="font-medium text-dark">¥ 2.5万</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-dark font-bold">本季度总收入</span>
                                <span class="font-bold text-success text-base">¥ 15.2万</span>
                            </div>
                        </div>
                    </div>

                    <p class="text-xs text-light">
                        注：公共收益将用于小区公共设施改造、绿化提升、社区活动组织等，具体使用方案将提交业主大会表决。
                    </p>
                </section>

                <section id="section6">
                    <h2>六、下季度工作计划</h2>
                    <p>
                        2026年第一季度，业委会将继续秉承"服务业主、维护权益"的宗旨，重点开展以下工作：
                    </p>

                    <div class="space-y-3">
                        <div class="border-l-4 border-primary bg-primary/5 rounded-r-lg p-3">
                            <h4 class="text-sm font-bold text-dark mb-1">1. 召开年度业主大会</h4>
                            <p class="text-xs text-light">审议年度工作报告、财务报告，表决重大事项</p>
                        </div>

                        <div class="border-l-4 border-success bg-success/5 rounded-r-lg p-3">
                            <h4 class="text-sm font-bold text-dark mb-1">2. 推进电梯更换项目</h4>
                            <p class="text-xs text-light">完成3号楼电梯更换，启动其他老旧电梯评估</p>
                        </div>

                        <div class="border-l-4 border-warning bg-warning/5 rounded-r-lg p-3">
                            <h4 class="text-sm font-bold text-dark mb-1">3. 完善智能化管理</h4>
                            <p class="text-xs text-light">引入AI助手，提升小区管理智能化水平</p>
                        </div>

                        <div class="border-l-4 border-purple bg-purple/5 rounded-r-lg p-3">
                            <h4 class="text-sm font-bold text-dark mb-1">4. 组织社区活动</h4>
                            <p class="text-xs text-light">开展邻里节、新春联欢等活动，增进业主交流</p>
                        </div>
                    </div>
                </section>

                <div class="mt-6 pt-6 border-t-2 border-border text-right">
                    <p class="text-sm text-dark font-medium">常州市XX小区业主委员会</p>
                    <p class="text-xs text-light mt-1">2025年12月1日</p>
                </div>
            </div>
        </div>

        <!-- 评论与讨论 -->
        <div class="bg-white rounded-xl p-4 mb-4">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-base font-bold text-dark flex items-center gap-2">
                    <i class="fa fa-comments text-primary"></i>
                    评论讨论 <span class="text-sm text-light font-normal" id="comment-count">(15)</span>
                </h3>
                <button onclick="sortComments()" class="text-xs text-light hover:text-primary">
                    <i class="fa fa-sort"></i> 排序
                </button>
            </div>

            <div class="space-y-3 mb-4" id="comments-list">
                <!-- 评论1 -->
                <div class="pb-3 border-b border-border comment-item" data-comment-id="comment-1">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
                            <span class="text-sm font-medium text-primary">张</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium text-dark">张先生</span>
                                <span class="text-xs text-light comment-time">2小时前</span>
                            </div>
                            <p class="text-sm text-dark mb-2">业委会辛苦了！本季度工作很到位，特别是外墙防水维修解决了大问题。</p>
                            <div class="flex items-center gap-3">
                                <button class="like-btn text-xs text-light hover:text-primary" onclick="toggleLike(this)">
                                    <i class="fa fa-thumbs-o-up"></i> <span class="like-count">8</span>
                                </button>
                                <button class="text-xs text-light hover:text-primary" onclick="replyComment(this, '张先生', 'comment-1')">
                                    <i class="fa fa-reply"></i> 回复
                                </button>
                            </div>
                            <!-- 回复列表 -->
                            <div class="replies-list mt-3 space-y-2 hidden"></div>
                            <!-- 展开更多回复按钮 -->
                            <button class="show-more-replies text-xs text-primary mt-2 hidden" onclick="toggleReplies(this)">
                                <i class="fa fa-angle-down"></i> 展开更多回复
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 评论2 -->
                <div class="pb-3 border-b border-border comment-item" data-comment-id="comment-2">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-full bg-success/10 flex items-center justify-center flex-shrink-0">
                            <span class="text-sm font-medium text-success">李</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium text-dark">李女士</span>
                                <span class="text-xs text-light comment-time">5小时前</span>
                            </div>
                            <p class="text-sm text-dark mb-2">希望下季度能加强停车管理，现在停车真的太难了。</p>
                            <div class="flex items-center gap-3">
                                <button class="like-btn text-xs text-light hover:text-primary" onclick="toggleLike(this)">
                                    <i class="fa fa-thumbs-o-up"></i> <span class="like-count">12</span>
                                </button>
                                <button class="text-xs text-light hover:text-primary" onclick="replyComment(this, '李女士', 'comment-2')">
                                    <i class="fa fa-reply"></i> 回复
                                </button>
                            </div>
                            <!-- 回复列表 -->
                            <div class="replies-list mt-3 space-y-2 hidden"></div>
                            <!-- 展开更多回复按钮 -->
                            <button class="show-more-replies text-xs text-primary mt-2 hidden" onclick="toggleReplies(this)">
                                <i class="fa fa-angle-down"></i> 展开更多回复
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 评论3 -->
                <div class="pb-3 border-b border-border comment-item" data-comment-id="comment-3">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-full bg-warning/10 flex items-center justify-center flex-shrink-0">
                            <span class="text-sm font-medium text-warning">王</span>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center justify-between mb-1">
                                <span class="text-sm font-medium text-dark">王先生</span>
                                <span class="text-xs text-light comment-time">1天前</span>
                            </div>
                            <p class="text-sm text-dark mb-2">公共收益能否用于改善儿童游乐设施？现在的设施有点老旧了。</p>
                            <div class="flex items-center gap-3">
                                <button class="like-btn text-xs text-light hover:text-primary" onclick="toggleLike(this)">
                                    <i class="fa fa-thumbs-o-up"></i> <span class="like-count">5</span>
                                </button>
                                <button class="text-xs text-light hover:text-primary" onclick="replyComment(this, '王先生', 'comment-3')">
                                    <i class="fa fa-reply"></i> 回复
                                </button>
                            </div>
                            <!-- 回复列表 -->
                            <div class="replies-list mt-3 space-y-2 hidden"></div>
                            <!-- 展开更多回复按钮 -->
                            <button class="show-more-replies text-xs text-primary mt-2 hidden" onclick="toggleReplies(this)">
                                <i class="fa fa-angle-down"></i> 展开更多回复
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 评论输入框 -->
            <div id="comment-input-area">
                <div class="flex gap-2">
                    <input type="text" id="comment-input" placeholder="发表您的看法..." class="flex-1 border border-border rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                    <button onclick="sendComment()" class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-dark">
                        发送
                    </button>
                </div>
                <p class="text-xs text-light mt-2">
                    <i class="fa fa-info-circle"></i> 请文明发言，理性讨论
                </p>
            </div>

            <!-- 回复输入框（隐藏） -->
            <div id="reply-input-area" class="hidden mt-3">
                <div class="bg-neutral-light rounded-lg p-3">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs text-dark">
                            回复 <span id="reply-target" class="text-primary font-medium"></span>
                        </span>
                        <button onclick="cancelReply()" class="text-xs text-light hover:text-dark">
                            <i class="fa fa-times"></i> 取消
                        </button>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="reply-input" placeholder="输入回复内容..." class="flex-1 border border-border rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                        <button onclick="sendReply()" class="bg-primary text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-primary-dark">
                            回复
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 相关报告 -->
        <div class="bg-white rounded-xl p-4">
            <h3 class="text-base font-bold text-dark mb-3 flex items-center gap-2">
                <i class="fa fa-file-text-o text-primary"></i>
                相关报告
            </h3>

            <div class="space-y-3">
                <div class="border border-border rounded-lg p-3 hover:border-primary/30 transition-all cursor-pointer">
                    <p class="text-sm font-medium text-dark mb-1">2025年第三季度业委会工作报告</p>
                    <p class="text-xs text-light">2025-09-01</p>
                </div>
                <div class="border border-border rounded-lg p-3 hover:border-primary/30 transition-all cursor-pointer">
                    <p class="text-sm font-medium text-dark mb-1">关于召开2026年第一次业主大会的通知</p>
                    <p class="text-xs text-light">2025-11-28</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        function toggleCatalog() {
            const content = document.getElementById('catalog-content');
            const toggle = document.getElementById('catalog-toggle');
            const icon = document.getElementById('catalog-icon');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = '收起';
                icon.className = 'fa fa-angle-up';
            } else {
                content.style.display = 'none';
                toggle.textContent = '展开';
                icon.className = 'fa fa-angle-down';
            }
        }

        function scrollToSection(sectionId) {
            const section = document.getElementById(sectionId);
            const headerOffset = 60;
            const elementPosition = section.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });

            // 更新目录激活状态
            document.querySelectorAll('.catalog-item').forEach(item => {
                item.classList.remove('active', 'text-primary');
                item.classList.add('text-light');
            });
            event.target.classList.add('active', 'text-primary');
            event.target.classList.remove('text-light');
        }

        function shareReport() {
            alert('分享功能 - 可分享到微信、朋友圈等');
        }

        function downloadReport() {
            alert('下载报告 - 生成PDF文件');
        }

        // 监听滚动，自动更新目录激活状态
        window.addEventListener('scroll', function() {
            const sections = ['section1', 'section2', 'section3', 'section4', 'section5', 'section6'];
            let currentSection = '';

            sections.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                const rect = section.getBoundingClientRect();
                if (rect.top <= 100 && rect.bottom >= 100) {
                    currentSection = sectionId;
                }
            });

            if (currentSection) {
                document.querySelectorAll('.catalog-item').forEach((item, index) => {
                    item.classList.remove('active', 'text-primary');
                    item.classList.add('text-light');
                    if (sections[index] === currentSection) {
                        item.classList.add('active', 'text-primary');
                        item.classList.remove('text-light');
                    }
                });
            }
        });

        // 评论功能相关变量
        let commentCount = 15;
        let currentSortOrder = 'time'; // 'time' 或 'likes'
        let currentReplyTarget = null;
        let currentReplyCommentId = null;
        let commentIdCounter = 4; // 从4开始,因为已有3个评论

        // 发送评论
        function sendComment() {
            const input = document.getElementById('comment-input');
            const content = input.value.trim();

            if (!content) {
                alert('请输入评论内容');
                return;
            }

            // 创建新评论元素
            const commentsList = document.getElementById('comments-list');
            const newComment = document.createElement('div');
            const newCommentId = 'comment-' + commentIdCounter++;
            newComment.className = 'pb-3 border-b border-border comment-item';
            newComment.setAttribute('data-comment-id', newCommentId);

            const colors = ['primary', 'success', 'warning', 'purple'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            const userName = '业主' + Math.floor(Math.random() * 1000);
            const userInitial = userName.charAt(0);

            newComment.innerHTML = `
                <div class="flex items-start gap-3">
                    <div class="w-8 h-8 rounded-full bg-${randomColor}/10 flex items-center justify-center flex-shrink-0">
                        <span class="text-sm font-medium text-${randomColor}">${userInitial}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-1">
                            <span class="text-sm font-medium text-dark">${userName}</span>
                            <span class="text-xs text-light comment-time">刚刚</span>
                        </div>
                        <p class="text-sm text-dark mb-2">${content}</p>
                        <div class="flex items-center gap-3">
                            <button class="like-btn text-xs text-light hover:text-primary" onclick="toggleLike(this)">
                                <i class="fa fa-thumbs-o-up"></i> <span class="like-count">0</span>
                            </button>
                            <button class="text-xs text-light hover:text-primary" onclick="replyComment(this, '${userName}', '${newCommentId}')">
                                <i class="fa fa-reply"></i> 回复
                            </button>
                        </div>
                        <div class="replies-list mt-3 space-y-2 hidden"></div>
                        <button class="show-more-replies text-xs text-primary mt-2 hidden" onclick="toggleReplies(this)">
                            <i class="fa fa-angle-down"></i> 展开更多回复
                        </button>
                    </div>
                </div>
            `;

            // 添加到评论列表顶部
            commentsList.insertBefore(newComment, commentsList.firstChild);

            // 清空输入框
            input.value = '';

            // 更新评论数量
            commentCount++;
            document.getElementById('comment-count').textContent = `(${commentCount})`;

            // 滚动到新评论
            newComment.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // 点赞功能
        function toggleLike(button) {
            const icon = button.querySelector('i');
            const countSpan = button.querySelector('.like-count');
            let count = parseInt(countSpan.textContent);

            if (icon.classList.contains('fa-thumbs-o-up')) {
                // 未点赞 -> 点赞
                icon.classList.remove('fa-thumbs-o-up');
                icon.classList.add('fa-thumbs-up');
                button.classList.remove('text-light');
                button.classList.add('text-primary');
                count++;
            } else {
                // 已点赞 -> 取消点赞
                icon.classList.remove('fa-thumbs-up');
                icon.classList.add('fa-thumbs-o-up');
                button.classList.remove('text-primary');
                button.classList.add('text-light');
                count--;
            }

            countSpan.textContent = count;
        }

        // 回复评论
        function replyComment(button, targetName, commentId) {
            currentReplyTarget = targetName;
            currentReplyCommentId = commentId;

            // 显示回复输入区域
            const replyArea = document.getElementById('reply-input-area');
            const commentArea = document.getElementById('comment-input-area');
            const replyTarget = document.getElementById('reply-target');

            replyArea.classList.remove('hidden');
            commentArea.classList.add('hidden');
            replyTarget.textContent = targetName;

            // 聚焦到回复输入框
            document.getElementById('reply-input').focus();

            // 滚动到回复输入框
            replyArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // 取消回复
        function cancelReply() {
            const replyArea = document.getElementById('reply-input-area');
            const commentArea = document.getElementById('comment-input-area');

            replyArea.classList.add('hidden');
            commentArea.classList.remove('hidden');

            // 清空回复输入框
            document.getElementById('reply-input').value = '';
            currentReplyTarget = null;
        }

        // 发送回复
        function sendReply() {
            const input = document.getElementById('reply-input');
            const content = input.value.trim();

            if (!content) {
                alert('请输入回复内容');
                return;
            }

            // 找到目标评论
            const targetComment = document.querySelector(`[data-comment-id="${currentReplyCommentId}"]`);
            if (!targetComment) {
                alert('目标评论不存在');
                return;
            }

            // 获取回复列表容器
            const repliesList = targetComment.querySelector('.replies-list');
            const showMoreBtn = targetComment.querySelector('.show-more-replies');

            // 创建新回复元素
            const colors = ['primary', 'success', 'warning', 'purple'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            const userName = '业主' + Math.floor(Math.random() * 1000);
            const userInitial = userName.charAt(0);

            const newReply = document.createElement('div');
            newReply.className = 'reply-item pl-3 border-l-2 border-gray-200';
            newReply.innerHTML = `
                <div class="flex items-start gap-2">
                    <div class="w-6 h-6 rounded-full bg-${randomColor}/10 flex items-center justify-center flex-shrink-0">
                        <span class="text-xs font-medium text-${randomColor}">${userInitial}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-1">
                            <div class="flex items-center gap-2">
                                <span class="text-xs font-medium text-dark">${userName}</span>
                                <span class="text-xs text-light">回复</span>
                                <span class="text-xs text-primary font-medium">@${currentReplyTarget}</span>
                            </div>
                            <span class="text-xs text-light">刚刚</span>
                        </div>
                        <p class="text-xs text-dark">${content}</p>
                    </div>
                </div>
            `;

            // 添加回复到列表
            repliesList.appendChild(newReply);

            // 显示回复列表
            if (repliesList.classList.contains('hidden')) {
                repliesList.classList.remove('hidden');
            }

            // 获取当前回复总数
            const replyCount = repliesList.querySelectorAll('.reply-item').length;

            // 处理展开/收起按钮显示逻辑
            if (replyCount > 3) {
                // 超过3条回复,显示"展开更多"按钮
                showMoreBtn.classList.remove('hidden');

                // 默认只显示前3条
                const allReplies = repliesList.querySelectorAll('.reply-item');
                allReplies.forEach((reply, index) => {
                    if (index >= 3) {
                        reply.classList.add('hidden');
                    }
                });

                // 更新按钮文本
                const hiddenCount = replyCount - 3;
                showMoreBtn.innerHTML = `<i class="fa fa-angle-down"></i> 展开更多回复 (${hiddenCount}条)`;
                showMoreBtn.setAttribute('data-expanded', 'false');
            } else {
                // 少于等于3条回复,隐藏按钮
                showMoreBtn.classList.add('hidden');
            }

            // 更新评论数量(回复也算评论)
            commentCount++;
            document.getElementById('comment-count').textContent = `(${commentCount})`;

            // 取消回复状态
            cancelReply();

            // 滚动到新回复
            newReply.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // 展开/收起回复
        function toggleReplies(button) {
            const repliesList = button.previousElementSibling;
            const allReplies = repliesList.querySelectorAll('.reply-item');
            const isExpanded = button.getAttribute('data-expanded') === 'true';

            if (isExpanded) {
                // 收起,只显示前3条
                allReplies.forEach((reply, index) => {
                    if (index >= 3) {
                        reply.classList.add('hidden');
                    }
                });
                const hiddenCount = allReplies.length - 3;
                button.innerHTML = `<i class="fa fa-angle-down"></i> 展开更多回复 (${hiddenCount}条)`;
                button.setAttribute('data-expanded', 'false');
            } else {
                // 展开,显示所有回复
                allReplies.forEach(reply => {
                    reply.classList.remove('hidden');
                });
                button.innerHTML = `<i class="fa fa-angle-up"></i> 收起回复`;
                button.setAttribute('data-expanded', 'true');
            }
        }

        // 评论排序
        function sortComments() {
            const commentsList = document.getElementById('comments-list');
            const comments = Array.from(commentsList.querySelectorAll('.comment-item'));

            if (currentSortOrder === 'time') {
                // 按点赞数排序
                currentSortOrder = 'likes';
                comments.sort((a, b) => {
                    const likesA = parseInt(a.querySelector('.like-count').textContent);
                    const likesB = parseInt(b.querySelector('.like-count').textContent);
                    return likesB - likesA;
                });
            } else {
                // 按时间排序(恢复默认顺序)
                currentSortOrder = 'time';
                comments.reverse();
            }

            // 重新添加到列表
            commentsList.innerHTML = '';
            comments.forEach(comment => {
                commentsList.appendChild(comment);
            });
        }

        // 回车发送评论
        document.getElementById('comment-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendComment();
            }
        });

        // 回车发送回复
        document.getElementById('reply-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendReply();
            }
        });
    </script>
</body>
</html>
