<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>å¸¸å·ä½æˆ¿AIåŠ©æ‰‹ - ä¸€ç«™å¼æˆ¿äº§æœåŠ¡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <script>
        // Tailwind è‡ªå®šä¹‰é…ç½®
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF', // å¸¸å·è“ä¸»è‰²è°ƒ
                        secondary: '#FF7D00', // è¾…åŠ©è‰²ï¼ˆå¸¸å·æ©™ï¼‰
                        neutral: '#F5F7FA', // ä¸­æ€§èƒŒæ™¯è‰²
                        dark: '#1D2129', // æ–‡å­—æ·±è‰²
                        light: '#86909C', // æ–‡å­—æµ…è‰²
                        success: '#00B42A', // åŒ¹é…æˆåŠŸè‰²
                        warning: '#FF7D00', // åŒ¹é…è­¦å‘Šè‰²
                    },
                    fontFamily: {
                        sans: ['PingFang SC', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .card-shadow { box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.08); }
            /* AIæ€è€ƒæ­¥éª¤åŠ¨ç”» */
            .thinking-step {
                border-left: 2px solid #E5E6EB;
                padding-left: 12px;
                margin-left: 4px;
                position: relative;
                opacity: 0;
                transform: translateX(-10px);
                transition: all 0.5s ease;
            }
            .thinking-step.active {
                opacity: 1;
                transform: translateX(0);
                border-left-color: #165DFF;
            }
            .thinking-step::before {
                content: '';
                position: absolute;
                left: -5px;
                top: 6px;
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #E5E6EB;
                transition: background 0.3s ease;
            }
            .thinking-step.active::before {
                background: #165DFF;
                box-shadow: 0 0 0 2px rgba(22, 93, 255, 0.2);
            }
            
            .thinking-loading {
                display: inline-block;
                width: 12px;
                height: 12px;
                border: 2px solid #165DFF;
                border-radius: 50%;
                border-top-color: transparent;
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            .match-tag {
                display: inline-flex;
                align-items: center;
                gap: 4px;
                padding: 3px 10px;
                font-size: 11px;
                font-weight: 600;
                border-radius: 999px;
                border: 1px solid currentColor;
                background: rgba(255, 255, 255, 0.95);
                box-shadow: 0 8px 15px rgba(0, 0, 0, 0.08);
            }
            .match-tag i {
                font-size: 11px;
            }
            .match-tag-success {
                color: #00B96B;
                border-color: rgba(0, 185, 107, 0.35);
                background: linear-gradient(135deg, rgba(0, 185, 107, 0.15), rgba(0, 185, 107, 0.05));
            }
            .match-tag-primary {
                color: #165DFF;
                border-color: rgba(22, 93, 255, 0.35);
                background: linear-gradient(135deg, rgba(22, 93, 255, 0.16), rgba(22, 93, 255, 0.05));
            }
            .match-tag-warning {
                color: #FF7D00;
                border-color: rgba(255, 125, 0, 0.35);
                background: linear-gradient(135deg, rgba(255, 125, 0, 0.18), rgba(255, 125, 0, 0.06));
            }
            .contact-menu {
                transform-origin: top right;
                transform: scale(0);
                transition: transform 0.2s ease;
            }
            .contact-menu.active {
                transform: scale(1);
            }
        }
    </style>
</head>
<body class="font-sans bg-neutral text-dark antialiased">
    <main class="container mx-auto px-4 py-4">

        <section id="module-agent" class="space-y-4">
            <section class="bg-white rounded-lg card-shadow p-4 mb-4">
                <h2 class="text-base font-medium mb-3 flex items-center">
                    <i class="fa fa-id-card-o text-primary mr-2"></i>
                    AIæˆ¿äº§ä¸­ä»‹ Â· ä¸€ç«™å¼äº¤æ˜“æœåŠ¡
                </h2>
                
                <div class="border border-primary/20 bg-primary/5 rounded-lg p-4 mb-4">
                    <h3 class="text-sm font-medium mb-3 flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fa fa-connectdevelop text-primary mr-2"></i>
                            ä¾›éœ€æ™ºèƒ½åŒ¹é…å¼•æ“
                        </div>
                        <span class="text-xs text-primary bg-primary/10 px-2 py-0.5 rounded-full">éšç§ä¿æŠ¤æ¨¡å¼å¼€å¯</span>
                    </h3>
                    
                    <div class="bg-white rounded-lg border border-gray-200 p-3 mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-sm font-medium flex items-center">
                                <div class="w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin mr-2" id="thinking-spinner"></div>
                                <i class="fa fa-check-circle text-success hidden mr-2" id="thinking-complete"></i>
                                <span id="thinking-status">AIæ·±åº¦æ¨ç†ä¸­</span>
                            </h4>
                            <button id="toggle-matching-process" class="text-xs text-primary flex items-center">
                                <i class="fa fa-chevron-up mr-1"></i>æ”¶èµ·æ€è€ƒ
                            </button>
                        </div>

                        <div id="matching-process-content" class="space-y-4 text-xs pt-2">
                            
                            <div class="thinking-step" data-step="1">
                                <p class="font-medium text-dark mb-1">Step 1ï¼šè´­æˆ¿èµ„æ ¼ä¸ç”¨æˆ·ç”»åƒé‡æ„</p>
                                <div class="text-light pl-1 space-y-1">
                                    <p>â€¢ æˆ·ç±/ç¤¾ä¿åŸºæ•°/å…¬ç§¯é‡‘åŸºæ•°/æˆ¿å±‹å¥—æ¬¡ åŒ¹é…åˆ†æï¼š</p>
                                    <p>â€¢ å®¶åº­ç”Ÿå‘½å‘¨æœŸé˜¶æ®µåˆ†æï¼šåŒ¹é…æ”¹å–„å‹å±…ä½éœ€æ±‚</p>
                                    <p>â€¢ èŒä½é€šå‹¤åŠå¾„æµ‹ç®—ï¼šåŸºäºé«˜é¢‘æ´»åŠ¨åŒºåŸŸåˆ’å®šæœ€ä¼˜ç”Ÿæ´»åœˆ</p>
                                </div>
                            </div>

                            <div class="thinking-step" data-step="2">
                                <p class="font-medium text-dark mb-1">Step 2ï¼šéœ€æ±‚æŒ–æ˜ä¸è¡Œä¸ºå»ºæ¨¡</p>
                                <div class="text-light pl-1 space-y-1">
                                    <p>â€¢ æœç´¢è¡Œä¸ºåˆ†æï¼šé«˜é¢‘å…³æ³¨â€œé‡‡å…‰â€ã€â€œå­¦åŒºâ€ã€â€œç‰©ä¸šæœåŠ¡â€å…³é”®è¯</p>
                                    <p>â€¢ åœç•™æ—¶é•¿æƒé‡ï¼šå¯¹â€œç²¾è£…â€ã€â€œæ¬¡æ–°æˆ¿â€ç±»æˆ¿æºè¯¦æƒ…é¡µåœç•™æ—¶é—´è¾ƒé•¿</p>
                                    <p>â€¢ è´Ÿé¢å‰”é™¤ï¼šè‡ªåŠ¨è¿‡æ»¤ä¸´è¡—ã€é¡¶åº•æ¥¼å±‚åŠå†å²å…³æ³¨åº¦ä½çš„æˆ¿æºç±»å‹</p>
                                </div>
                            </div>
                            
                            <div class="thinking-step" data-step="3">
                                <p class="font-medium text-dark mb-1">Step 3ï¼šèµ„é‡‘æ‰¿å‹æ¨¡å‹ä¸æ€§ä»·æ¯”è¯„ä¼°</p>
                                <div class="text-light pl-1 space-y-1">
                                    <p>â€¢ æ”¯ä»˜èƒ½åŠ›æµ‹ç®—ï¼šå…¬ç§¯é‡‘+å•†è´·ç»„åˆé¢åº¦ > ç›®æ ‡æˆ¿æºå‡ä»·ï¼Œèµ„é‡‘é“¾å¥åº·</p>
                                    <p>â€¢ åŒºåŸŸä»·å€¼é”šç‚¹ï¼šå¯¹æ¯”åŒæ¿å—è¿‘6ä¸ªæœˆæˆäº¤å‡ä»·ï¼Œå‰”é™¤æº¢ä»·ç‡>15%çš„æˆ¿æº</p>
                                </div>
                            </div>
                            
                            <div class="thinking-step" data-step="4">
                                <p class="font-medium text-dark mb-1">Step 4ï¼šå–æ–¹å¿ƒç†ç”»åƒä¸åšå¼ˆåˆ†æ</p>
                                <div class="text-light pl-1 space-y-1">
                                    <p>â€¢ å”®æˆ¿æ„æ„¿è¯„çº§ï¼šç­›é€‰â€œè¯šæ„å‡ºå”®â€ä¸”æŒ‚ç‰ŒæœŸåˆç†çš„æˆ¿æº</p>
                                    <p>â€¢ ä»·æ ¼å¼¹æ€§é¢„æµ‹ï¼šåŸºäºå–æ–¹è°ƒä»·å†å²ï¼Œè®¡ç®—æ½œåœ¨è®®ä»·ç©ºé—´</p>
                                </div>
                            </div>

                             <div class="thinking-step" data-step="5">
                                <p class="font-medium text-dark mb-1">Step 5ï¼šä¾›éœ€è¡”æ¥å¯è¡Œæ€§æ¨¡æ‹Ÿ</p>
                                <div class="text-light pl-1 space-y-1">
                                    <p>â€¢ æœ€ç»ˆå†³ç­–ï¼šä»å…¨åº“32,5800å¥—æˆ¿æºä¸­ï¼Œä¼˜é€‰Top 10é«˜åŒ¹é…åº¦æˆ¿æº</p>
                                </div>
                            </div>
                            
                        </div>
                    </div>

                    <!-- æ¨èç»“æœåŒºåŸŸ - åˆå§‹éšè— -->
                    <div id="recommendation-results" class="hidden">
                    <div class="bg-white rounded-lg border border-gray-200 p-3 mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="text-sm font-medium">è®¡ç®—å®Œæˆï¼šTop 10 æ¨è</h4>
                            <div class="text-xs text-light"></div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 text-center text-xs">
                            <div class="p-2 bg-success/10 rounded border border-success/20">
                                <p class="text-success font-bold text-sm">3å¥—</p>
                                <p class="text-light scale-90">Sçº§ æåº¦åŒ¹é…</p>
                            </div>
                            <div class="p-2 bg-primary/10 rounded border border-primary/20">
                                <p class="text-primary font-bold text-sm">5å¥—</p>
                                <p class="text-light scale-90">Açº§ é«˜åº¦åŒ¹é…</p>
                            </div>
                            <div class="p-2 bg-secondary/10 rounded border border-secondary/20">
                                <p class="text-secondary font-bold text-sm">2å¥—</p>
                                <p class="text-light scale-90">Bçº§ æ½œåŠ›åŒ¹é…</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="bg-white rounded-lg border border-gray-200 p-3 hover:border-primary transition">
                            <div class="flex flex-col md:flex-row gap-3">
                                <div class="w-full md:w-1/3 bg-neutral h-40 md:h-auto rounded-lg overflow-hidden">
                                    <img src="https://img2-build.jiwu.com/album/manual/2025/07/09/141142450286.jpg/jiwu$800x600" alt="æ˜Ÿæ²³å›½é™…ä¸‰æœŸ å®æ™¯" class="w-full h-full object-cover">
                                </div>
                                <div class="w-full md:w-2/3">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-medium text-sm">æ˜Ÿæ²³å›½é™…ä¸‰æœŸ 118ã¡ ä¸‰å±…å®¤</h4>
                                        <span class="match-tag match-tag-success">
                                            <i class="fa fa-star mr-1"></i>AIåŒ¹é…åº¦ 96%
                                        </span>
                                    </div>
                                    
                                    <div class="text-xs text-light mb-3 flex flex-wrap gap-2">
                                        <span><i class="fa fa-map-marker mr-1"></i>æ­¦è¿›åŒºæ¹–å¡˜è¡—é“</span>
                                        <span><i class="fa fa-rmb mr-1"></i>æŒ‚ç‰Œä»·ï¼š192ä¸‡</span>
                                        <span><i class="fa fa-calendar mr-1"></i>æˆ¿é¾„ï¼š8å¹´</span>
                                        <span><i class="fa fa-building mr-1"></i>ä¸­é«˜å±‚</span>
                                        <span><i class="fa fa-paint-brush mr-1"></i>ç²¾è£…ä¿®</span>
                                    </div>
                                    
                                    <div class="mb-3 bg-neutral rounded p-2">
                                        <p class="text-xs font-medium mb-1 text-dark">ğŸ’¡ AIæ¨èç†ç”±ï¼š</p>
                                        <div class="flex flex-wrap gap-1">
                                            <span class="px-1.5 py-0.5 bg-white border border-gray-200 text-dark text-xs rounded">åŒºä½ä»·å€¼ä¼˜é€‰</span>
                                            <span class="px-1.5 py-0.5 bg-white border border-gray-200 text-dark text-xs rounded">æˆ·å‹é€‚é…åº¦é«˜</span>
                                            <span class="px-1.5 py-0.5 bg-white border border-gray-200 text-dark text-xs rounded">èµ„äº§ä¿å€¼ä¼˜é€‰</span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex flex-wrap items-center gap-3 border-t border-gray-100 pt-2">
                                        <div class="flex items-center flex-1 min-w-[180px]">
                                            <div class="relative group">
                                                <div class="relative">
                                                    <img src="https://picsum.photos/40/40?random=101" alt="æˆ¿ä¸»å¤´åƒ" class="w-8 h-8 rounded-full border-2 border-white shadow-sm cursor-pointer hover:border-primary transition">
                                                    <span class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-success border-2 border-white rounded-full"></span>
                                                </div>
                                                <div class="contact-menu absolute left-0 bottom-full mb-2 w-36 bg-white rounded-lg shadow-xl border border-gray-200 p-2 z-10">
                                                    <div class="flex justify-between text-xs">
                                                        <button class="flex flex-col items-center p-1 hover:bg-neutral rounded text-dark">
                                                            <i class="fa fa-commenting-o text-primary mb-1 text-sm"></i>
                                                            <span>ç§èŠ</span>
                                                        </button>
                                                        <button class="flex flex-col items-center p-1 hover:bg-neutral rounded text-dark">
                                                            <i class="fa fa-phone text-success mb-1 text-sm"></i>
                                                            <span>é€šè¯</span>
                                                        </button>
                                                        <button class="flex flex-col items-center p-1 hover:bg-neutral rounded text-dark">
                                                            <i class="fa fa-video-camera text-secondary mb-1 text-sm"></i>
                                                            <span>è§†é¢‘</span>
                                                        </button>
                                                    </div>
                                                    <div class="text-[10px] text-center text-light mt-1 border-t pt-1">å®åè®¤è¯æˆ¿ä¸»</div>
                                                </div>
                                            </div>
                                            <div class="ml-2 flex flex-col">
                                                <span class="text-xs font-medium text-dark">æå¥³å£« <span class="text-[10px] bg-primary/10 text-primary px-1 rounded ml-1">æˆ¿ä¸»</span></span>
                                                <span class="text-[10px] text-light">å½“å‰åœ¨çº¿</span>
                                            </div>
                                        </div>
                                        <div class="flex gap-2 shrink-0 ml-auto">
                                            <button class="px-3 py-1 bg-white border border-primary text-primary text-xs rounded-full hover:bg-primary/5 transition shadow-sm flex items-center whitespace-nowrap" onclick="openAgentDetail(101)">
                                                <i class="fa fa-eye mr-1"></i>æŸ¥çœ‹è¯¦æƒ…
                                            </button>
                                            <button class="px-3 py-1 bg-primary text-white text-xs rounded-full hover:bg-blue-600 transition shadow-sm whitespace-nowrap" onclick="openAgentConsult(101)">
                                                åœ¨çº¿å’¨è¯¢
                                            </button>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg border border-gray-200 p-3 hover:border-primary transition">
                            <div class="flex flex-col md:flex-row gap-3">
                                <div class="w-full md:w-1/3 bg-neutral h-40 md:h-auto rounded-lg overflow-hidden">
                                    <img src="https://p9.itc.cn/q_70/images01/20231012/ce912d35e8164e26819d0c08969e1d5a.png" alt="ä¸–èŒ‚é¦™æ§Ÿæ¹– å®æ™¯" class="w-full h-full object-cover">
                                </div>
                                <div class="w-full md:w-2/3">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-medium text-sm">ä¸–èŒ‚é¦™æ§Ÿæ¹–äºŒæœŸ 105ã¡ ä¸‰å±…å®¤</h4>
                                        <span class="match-tag match-tag-primary">
                                            <i class="fa fa-star-half-o mr-1"></i>AIåŒ¹é…åº¦ 91%
                                        </span>
                                    </div>
                                    
                                    <div class="text-xs text-light mb-3 flex flex-wrap gap-2">
                                        <span><i class="fa fa-map-marker mr-1"></i>æ–°åŒ—åŒºå¤ªæ¹–ä¸œè·¯</span>
                                        <span><i class="fa fa-rmb mr-1"></i>æŒ‚ç‰Œä»·ï¼š185ä¸‡</span>
                                        <span><i class="fa fa-calendar mr-1"></i>æˆ¿é¾„ï¼š7å¹´</span>
                                        <span><i class="fa fa-paint-brush mr-1"></i>ç²¾è£…ä¿®</span>
                                    </div>
                                    
                                    <div class="mb-3 bg-neutral rounded p-2">
                                        <p class="text-xs font-medium mb-1 text-dark">ğŸ’¡ AIæ¨èç†ç”±ï¼š</p>
                                        <div class="flex flex-wrap gap-1">
                                            <span class="px-1.5 py-0.5 bg-white border border-gray-200 text-dark text-xs rounded">ç”Ÿæ´»é…å¥—æˆç†Ÿ</span>
                                            <span class="px-1.5 py-0.5 bg-white border border-gray-200 text-dark text-xs rounded">æ€§ä»·æ¯”ä¹‹é€‰</span>
                                            <span class="px-1.5 py-0.5 bg-white border border-gray-200 text-dark text-xs rounded">é¢„ç®—é€‚é…åº¦å¥‘åˆ</span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex flex-wrap items-center gap-3 border-t border-gray-100 pt-2">
                                        <div class="flex items-center flex-1 min-w-[180px]">
                                            <div class="relative group">
                                                <div class="relative">
                                                    <img src="https://picsum.photos/40/40?random=102" alt="æˆ¿ä¸»å¤´åƒ" class="w-8 h-8 rounded-full border-2 border-white shadow-sm cursor-pointer hover:border-primary transition">
                                                </div>
                                                <div class="contact-menu absolute left-0 bottom-full mb-2 w-36 bg-white rounded-lg shadow-xl border border-gray-200 p-2 z-10">
                                                    <div class="flex justify-between text-xs">
                                                        <button class="flex flex-col items-center p-1 hover:bg-neutral rounded text-dark">
                                                            <i class="fa fa-commenting-o text-primary mb-1 text-sm"></i>
                                                            <span>ç§èŠ</span>
                                                        </button>
                                                        <button class="flex flex-col items-center p-1 hover:bg-neutral rounded text-dark">
                                                            <i class="fa fa-phone text-success mb-1 text-sm"></i>
                                                            <span>é€šè¯</span>
                                                        </button>
                                                        <button class="flex flex-col items-center p-1 hover:bg-neutral rounded text-dark">
                                                            <i class="fa fa-video-camera text-secondary mb-1 text-sm"></i>
                                                            <span>è§†é¢‘</span>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ml-2 flex flex-col">
                                                <span class="text-xs font-medium text-dark">å¼ å…ˆç”Ÿ <span class="text-[10px] bg-primary/10 text-primary px-1 rounded ml-1">ç»çºªäºº</span></span>
                                                <span class="text-[10px] text-light">1å°æ—¶å‰åœ¨çº¿</span>
                                            </div>
                                        </div>
                                        <div class="flex gap-2 shrink-0 ml-auto">
                                            <button class="px-3 py-1 bg-white border border-primary text-primary text-xs rounded-full hover:bg-primary/5 transition shadow-sm flex items-center whitespace-nowrap" onclick="openAgentDetail(102)">
                                                <i class="fa fa-eye mr-1"></i>æŸ¥çœ‹è¯¦æƒ…
                                            </button>
                                            <button class="px-3 py-1 bg-primary text-white text-xs rounded-full hover:bg-blue-600 transition shadow-sm whitespace-nowrap" onclick="openAgentConsult(102)">
                                                åœ¨çº¿å’¨è¯¢
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="agent-load-wrapper" class="text-center py-2">
                            <button id="load-more-agent" class="text-primary text-xs flex items-center mx-auto hover:underline">
                                åŠ è½½å‰©ä½™ 8 å¥—é«˜åŒ¹é…æˆ¿æº <i class="fa fa-angle-double-down ml-1"></i>
                            </button>
                        </div>
                        <div id="extra-agent-listings" class="space-y-4 hidden"></div>
                        <div id="agent-loaded-message" class="text-[11px] text-light text-center py-2 hidden">
                            å·²å±•ç¤ºå…¨éƒ¨é«˜åŒ¹é…æˆ¿æºï¼Œæ›´å¤šæˆ¿æºå¯è”ç³»AIä¸­ä»‹è·å–ä¸“å±æ¨è
                        </div>
                    </div>
                    </div>
                    <!-- æ¨èç»“æœåŒºåŸŸç»“æŸ -->
                </div>
                
                <div>
                    <h3 class="text-sm font-medium mb-2 flex items-center">
                        <i class="fa fa-comments text-primary mr-2"></i>
                        AIä¸­ä»‹æ™ºèƒ½å’¨è¯¢
                    </h3>
                    <div id="chat-container-agent" class="h-48 overflow-y-auto scrollbar-hide border border-gray-200 rounded-lg p-3 mb-3 space-y-3">
                        <div class="flex items-start">
                            <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs mr-2">AI</div>
                            <div class="bg-neutral rounded-lg px-3 py-2 text-sm max-w-[80%]">
                               å·²ä¸ºæ‚¨æ™ºèƒ½åŒ¹é…10å¥—ä¼˜è´¨æˆ¿æºï¼Œç‚¹å‡»æˆ¿æºå³å¯é¢„çº¦çœ‹æˆ¿ï¼Œæˆ–åœ¨çº¿æ²Ÿé€šã€‚è‹¥æ‚¨æœ‰ä¹°æˆ¿ã€å–æˆ¿ç›¸å…³éœ€æ±‚ï¼Œæ¬¢è¿éšæ—¶å’¨è¯¢ã€‚
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="chat-input-agent" placeholder="ä¾‹å¦‚ï¼šé¦–å¥—æˆ¿å¥‘ç¨æ€ä¹ˆç®—ï¼Ÿ" class="flex-1 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-primary">
                        <button id="send-btn-agent" class="px-4 py-2 bg-primary text-white rounded-lg text-sm">
                            <i class="fa fa-paper-plane mr-1"></i>å‘é€
                        </button>
                    </div>
                </div>
            </section>
        </section>
    </main>

    <script>
        const THINKING_STATE_KEY = 'ai-agent-thinking-finished';

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ‰§è¡ŒAIæ¨ç†è¿‡ç¨‹
        window.addEventListener('DOMContentLoaded', function() {
            const hasCompleted = sessionStorage.getItem(THINKING_STATE_KEY) === 'done';
            if (hasCompleted) {
                fastForwardThinkingProcess();
            } else {
                startThinkingProcess();
            }
        });

        // å¼€å§‹AIæ¨ç†è¿‡ç¨‹
        function startThinkingProcess() {
            const steps = document.querySelectorAll('.thinking-step');

            // é€æ­¥æ˜¾ç¤ºæ€è€ƒæ­¥éª¤
            steps.forEach((step, index) => {
                setTimeout(() => {
                    step.classList.add('active');
                }, 500 * (index + 1));
            });

            // æ‰€æœ‰æ­¥éª¤å®Œæˆå,æ˜¾ç¤ºæ¨èç»“æœ
            const totalTime = 500 * steps.length + 1000;
            setTimeout(() => {
                completeThinkingProcess();
            }, totalTime);
        }

        function fastForwardThinkingProcess() {
            const steps = document.querySelectorAll('.thinking-step');
            steps.forEach(step => step.classList.add('active'));
            completeThinkingProcess({ shouldScroll: false, persistState: false, immediate: true });
        }

        function completeThinkingProcess(options = {}) {
            const { shouldScroll = true, persistState = true, immediate = false } = options;
            document.getElementById('thinking-spinner').classList.add('hidden');
            document.getElementById('thinking-complete').classList.remove('hidden');
            document.getElementById('thinking-status').textContent = 'AIæ¨ç†å®Œæˆ';

            const showResults = () => {
                const resultSection = document.getElementById('recommendation-results');
                resultSection.classList.remove('hidden');
                if (shouldScroll) {
                    resultSection.scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest'
                    });
                }
            };

            if (immediate) {
                showResults();
            } else {
                setTimeout(showResults, 500);
            }

            if (persistState) {
                sessionStorage.setItem(THINKING_STATE_KEY, 'done');
            }
        }

        // åŒ¹é…è¿‡ç¨‹å±•å¼€/æ”¶èµ·åŠŸèƒ½
        document.getElementById('toggle-matching-process').addEventListener('click', function() {
            const content = document.getElementById('matching-process-content');
            const icon = this.querySelector('i');

            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
                this.innerHTML = '<i class="fa fa-chevron-up mr-1"></i>æ”¶èµ·æ€è€ƒ';

                // å¦‚æœè¿˜æ²¡æœ‰å®Œæˆæ¨ç†,é‡æ–°æ’­æ”¾åŠ¨ç”»
                const spinner = document.getElementById('thinking-spinner');
                if (!spinner.classList.contains('hidden')) {
                    const steps = document.querySelectorAll('.thinking-step');
                    steps.forEach((step, index) => {
                        step.classList.remove('active');
                        setTimeout(() => {
                            step.classList.add('active');
                        }, 300 * (index + 1));
                    });
                }
            } else {
                content.classList.add('hidden');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
                this.innerHTML = '<i class="fa fa-chevron-down mr-1"></i>å±•å¼€æ€è€ƒ';
            }
        });

        // æˆ¿ä¸»è”ç³»èœå•äº¤äº’
        document.querySelectorAll('.relative.group').forEach(group => {
            const img = group.querySelector('img');
            const menu = group.querySelector('.contact-menu');
            
            if(img && menu) {
                // ç‚¹å‡»å¤´åƒåˆ‡æ¢èœå•
                img.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // å…³é—­å…¶ä»–æ‰“å¼€çš„èœå•
                    document.querySelectorAll('.contact-menu.active').forEach(m => {
                        if(m !== menu) m.classList.remove('active');
                    });
                    menu.classList.toggle('active');
                });
            }
        });

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æ‰€æœ‰èœå•
        document.addEventListener('click', function() {
            document.querySelectorAll('.contact-menu.active').forEach(menu => {
                menu.classList.remove('active');
            });
        });

        function openAgentDetail(id) {
            window.location.href = `pages/agent/house-detail.html?id=${id}`;
        }

        function openAgentConsult(id, type = 'consult', presetQuestion = '') {
            const params = new URLSearchParams({ id, type });
            if (presetQuestion) {
                params.set('question', presetQuestion);
            }
            window.location.href = `pages/agent/consult.html?${params.toString()}`;
        }

        const PRIMARY_AGENT_LISTINGS = [101, 102];
        const loadMoreAgentBtn = document.getElementById('load-more-agent');
        const loadMoreWrapper = document.getElementById('agent-load-wrapper');
        const loadedMessage = document.getElementById('agent-loaded-message');
        const extraListingsContainer = document.getElementById('extra-agent-listings');
        let extraListingsLoaded = false;

        if (loadMoreAgentBtn) {
            loadMoreAgentBtn.addEventListener('click', handleLoadMoreListings);
        }

        async function handleLoadMoreListings() {
            if (extraListingsLoaded) {
                extraListingsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                return;
            }

            const originalHtml = loadMoreAgentBtn.innerHTML;
            loadMoreAgentBtn.disabled = true;
            loadMoreAgentBtn.innerHTML = '<span class="flex items-center mx-auto gap-1"><i class="fa fa-spinner fa-spin"></i> æ­£åœ¨åŠ è½½...</span>';

            try {
                const response = await fetch('assets/data/agent-listings.json');
                if (!response.ok) throw new Error('åŠ è½½æˆ¿æºå¤±è´¥');
                const data = await response.json();
                const extras = (data.listings || []).filter(item => !PRIMARY_AGENT_LISTINGS.includes(item.id));

                if (!extras.length) {
                    loadMoreAgentBtn.innerHTML = 'æš‚æ— æ›´å¤šæˆ¿æº';
                    return;
                }

                extraListingsContainer.innerHTML = extras.map(renderExtraListingCard).join('');
                extraListingsContainer.classList.remove('hidden');
                extraListingsLoaded = true;
                if (loadMoreWrapper) loadMoreWrapper.classList.add('hidden');
                if (loadedMessage) loadedMessage.classList.remove('hidden');
                extraListingsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {
                console.error(error);
                loadMoreAgentBtn.innerHTML = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                loadMoreAgentBtn.disabled = false;
            }
        }

        function renderExtraListingCard(listing) {
            const matchClass = getMatchTagClass(listing.matchLevel || '');
            const tags = (listing.matchTags || []).map(tag => `<span class="px-1.5 py-0.5 bg-white border border-gray-200 text-dark text-xs rounded">${tag}</span>`).join('');
            const price = listing.price ? `<span><i class="fa fa-rmb mr-1"></i>æŒ‚ç‰Œä»·ï¼š${listing.price}ä¸‡</span>` : '';
            const district = listing.district ? `<span><i class="fa fa-map-marker mr-1"></i>${listing.district}</span>` : '';
            const floor = listing.floor ? `<span><i class="fa fa-building mr-1"></i>${listing.floor}</span>` : '';
            const decor = listing.decoration ? `<span><i class="fa fa-paint-brush mr-1"></i>${listing.decoration}</span>` : '';
            const ownerName = listing.owner?.name || 'ä¸“å±é¡¾é—®';
            const ownerRole = listing.owner?.role || 'ç»çºªäºº';
            const ownerStatus = listing.owner?.status || 'åœ¨çº¿å’¨è¯¢';
            const ownerAvatar = listing.owner?.avatar || 'https://picsum.photos/40/40';
            return `
                <div class="bg-white rounded-lg border border-gray-200 p-3 hover:border-primary transition">
                    <div class="flex flex-col md:flex-row">
                        <div class="w-full md:w-1/3 bg-neutral h-40 md:h-auto flex items-center justify-center rounded-lg overflow-hidden mb-3 md:mb-0">
                            <img src="${listing.cover}" alt="${listing.displayName}" class="w-full h-full object-cover">
                        </div>
                        <div class="w-full md:w-2/3 p-3">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-medium text-sm">${listing.displayName}</h4>
                                <span class="match-tag ${matchClass}">
                                    <i class="fa fa-star mr-1"></i>AIåŒ¹é…åº¦ ${listing.matchRate || '--'}%
                                </span>
                            </div>
                            <div class="text-xs text-light mb-3 flex flex-wrap gap-2">
                                ${district}
                                ${price}
                                ${floor}
                                ${decor}
                            </div>
                            <div class="mb-3 bg-neutral rounded p-2">
                                <p class="text-xs font-medium mb-1 text-dark">ğŸ’¡ AIæ¨èç†ç”±ï¼š</p>
                                <div class="flex flex-wrap gap-1">
                                    ${tags || '<span class="px-1.5 py-0.5 bg-white border border-gray-200 text-dark text-xs rounded">AIæ­£åœ¨åŒ¹é…äº®ç‚¹...</span>'}
                                </div>
                            </div>
                            <div class="flex flex-wrap items-center gap-3 border-t border-gray-100 pt-2">
                                <div class="flex items-center flex-1 min-w-[180px]">
                                    <img src="${ownerAvatar}" class="w-8 h-8 rounded-full border-2 border-white shadow-sm" alt="${ownerName}">
                                    <div class="ml-2 flex flex-col">
                                        <span class="text-xs font-medium text-dark">${ownerName} <span class="text-[10px] bg-primary/10 text-primary px-1 rounded ml-1">${ownerRole}</span></span>
                                        <span class="text-[10px] text-light">${ownerStatus}</span>
                                    </div>
                                </div>
                                <div class="flex gap-2 shrink-0 ml-auto">
                                    <button class="px-3 py-1 bg-white border border-primary text-primary text-xs rounded-full hover:bg-primary/5 transition shadow-sm flex items-center whitespace-nowrap" onclick="openAgentDetail(${listing.id})">
                                        <i class="fa fa-eye mr-1"></i>æŸ¥çœ‹è¯¦æƒ…
                                    </button>
                                    <button class="px-3 py-1 bg-primary text-white text-xs rounded-full hover:bg-blue-600 transition shadow-sm whitespace-nowrap" onclick="openAgentConsult(${listing.id})">
                                        åœ¨çº¿å’¨è¯¢
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getMatchTagClass(level) {
            if (level && level.includes('S')) return 'match-tag-success';
            if (level && level.includes('A')) return 'match-tag-primary';
            return 'match-tag-warning';
        }
        
        // å‘é€æ¶ˆæ¯åŠŸèƒ½
        document.getElementById('send-btn-agent').addEventListener('click', function() {
            const input = document.getElementById('chat-input-agent');
            const message = input.value.trim();
            if (message) {
                const chatContainer = document.getElementById('chat-container-agent');
                
                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                const userMessage = document.createElement('div');
                userMessage.className = 'flex items-start justify-end';
                userMessage.innerHTML = `
                    <div class="bg-primary/10 rounded-lg px-3 py-2 text-sm max-w-[80%]">
                        ${message}
                    </div>
                    <div class="w-8 h-8 rounded-full bg-gray-200 text-dark flex items-center justify-center text-xs ml-2">
                        <i class="fa fa-user"></i>
                    </div>
                `;
                chatContainer.appendChild(userMessage);
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                input.value = '';
                
                // æ»šåŠ¨åˆ°åº•éƒ¨
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // æ¨¡æ‹ŸAIå›å¤
                setTimeout(() => {
                    const aiMessage = document.createElement('div');
                    aiMessage.className = 'flex items-start';
                    aiMessage.innerHTML = `
                        <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center text-xs mr-2">AI</div>
                        <div class="bg-neutral rounded-lg px-3 py-2 text-sm max-w-[80%]">
                            æ”¶åˆ°æ‚¨çš„å’¨è¯¢ã€‚æ­£åœ¨æ£€ç´¢ç›¸å…³æ³•å¾‹æ¡æ¬¾å’Œå¸‚åœºæ•°æ®ï¼Œè¯·ç¨å€™...
                        </div>
                    `;
                    chatContainer.appendChild(aiMessage);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 800);
            }
        });
        
        // æ”¯æŒå›è½¦é”®å‘é€æ¶ˆæ¯
        document.getElementById('chat-input-agent').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('send-btn-agent').click();
            }
        });
    </script>
</body>
</html>
