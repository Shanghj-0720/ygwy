<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>补充装修方案 - 智慧服务平台</title>
    <link rel="stylesheet" href="assets/css/renovation.css">
</head>
<body>
    <header class="header">
        <button class="back-btn" onclick="goBack()">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
            </svg>
        </button>
        <div class="header-content">
            <p class="eyebrow">方案变更</p>
            <h1>补充装修方案</h1>
            <p class="subtitle">上传变更或补充的装修方案</p>
        </div>
    </header>

    <main class="page">
        <!-- 房屋信息 -->
        <section class="card">
            <div class="card-header">
                <div>
                    <p class="eyebrow">房屋信息</p>
                    <h2>装修房屋</h2>
                </div>
                <span class="status-tag success">已登记</span>
            </div>
            <div class="house-info">
                <div class="house-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                </div>
                <div class="house-detail">
                    <div class="house-address">常州市天宁区某某花园12栋1单元101室</div>
                    <div class="house-meta">
                        <span>公安编号: 320400001234</span>
                        <span>登记编号: ZX2024011500001</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 补充原因 -->
        <section class="card">
            <div class="card-header">
                <div>
                    <p class="eyebrow">补充原因</p>
                    <h2>变更说明</h2>
                </div>
                <span class="required-tag">必填</span>
            </div>
            <div class="reason-options">
                <label class="reason-option">
                    <input type="radio" name="reason" value="plan_change" checked>
                    <span class="reason-radio"></span>
                    <span class="reason-text">装修方案变更</span>
                </label>
                <label class="reason-option">
                    <input type="radio" name="reason" value="over_scope">
                    <span class="reason-radio"></span>
                    <span class="reason-text">超范围施工补充</span>
                </label>
                <label class="reason-option">
                    <input type="radio" name="reason" value="other">
                    <span class="reason-radio"></span>
                    <span class="reason-text">其他原因</span>
                </label>
            </div>
            <textarea class="supplement-remark" id="remarkInput" placeholder="请补充说明变更或补充的具体内容..."></textarea>
        </section>

        <!-- 上传补充方案 -->
        <section class="card">
            <div class="card-header">
                <div>
                    <p class="eyebrow">上传材料</p>
                    <h2>补充装修方案</h2>
                </div>
                <span class="required-tag">必填</span>
            </div>
            <p class="card-desc">请上传变更或补充后的装饰装修方案。</p>

            <div class="upload-area" id="planUpload">
                <div class="upload-box" onclick="triggerUpload('plan')">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17,8 12,3 7,8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </div>
                    <div class="upload-text">
                        <span class="upload-main">点击上传装修方案</span>
                        <span class="upload-hint">支持jpg、png、pdf格式</span>
                    </div>
                </div>
                <input type="file" id="planInput" multiple accept="image/*,.pdf" style="display:none" onchange="handleFileSelect(this, 'plan')">
                <div class="preview-list" id="planPreview"></div>
            </div>
        </section>

        <!-- 提交按钮 -->
        <div class="submit-area">
            <button type="button" class="btn outline" onclick="goBack()">取消</button>
            <button type="button" class="btn primary" id="submitBtn" onclick="submitSupplement()">提交补充方案</button>
        </div>

        <!-- 帮助提示 -->
        <section class="help-tips">
            <div class="tip-item">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4"/>
                    <path d="M12 8h.01"/>
                </svg>
                <span>补充方案提交后，物业和产权人均可查阅</span>
            </div>
        </section>
    </main>

    <!-- 成功弹窗 -->
    <div class="modal" id="successModal" style="display: none;">
        <div class="modal-backdrop" onclick="closeModal()"></div>
        <div class="modal-content">
            <div class="modal-icon success">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22,4 12,14.01 9,11.01"/>
                </svg>
            </div>
            <h3>补充方案提交成功</h3>
            <p>您的补充装修方案已提交，物业和产权人可查阅。</p>
            <div class="modal-actions">
                <button class="btn primary" onclick="goToDetail()">返回登记详情</button>
            </div>
        </div>
    </div>

    <script src="assets/js/renovation.js"></script>
    <script>
        // 文件存储
        let uploadedFiles = {
            plan: []
        };

        // 触发文件选择
        function triggerUpload(type) {
            document.getElementById(type + 'Input').click();
        }

        // 处理文件选择
        function handleFileSelect(input, type) {
            const files = Array.from(input.files);
            files.forEach(file => {
                if (uploadedFiles[type].length < 10) {
                    uploadedFiles[type].push(file);
                    addPreview(file, type);
                }
            });
            input.value = '';
        }

        // 添加预览
        function addPreview(file, type) {
            const preview = document.getElementById(type + 'Preview');
            const item = document.createElement('div');
            item.className = 'preview-item';

            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    item.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}">
                        <button class="remove-btn" onclick="removeFile('${type}', '${file.name}')">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                item.innerHTML = `
                    <div class="file-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                        </svg>
                    </div>
                    <span class="file-name">${file.name}</span>
                    <button class="remove-btn" onclick="removeFile('${type}', '${file.name}')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                `;
            }

            preview.appendChild(item);
        }

        // 移除文件
        function removeFile(type, fileName) {
            uploadedFiles[type] = uploadedFiles[type].filter(f => f.name !== fileName);
            renderPreviews(type);
        }

        // 重新渲染预览
        function renderPreviews(type) {
            const preview = document.getElementById(type + 'Preview');
            preview.innerHTML = '';
            uploadedFiles[type].forEach(file => addPreview(file, type));
        }

        // 提交补充方案
        function submitSupplement() {
            const reason = document.querySelector('input[name="reason"]:checked');
            const remark = document.getElementById('remarkInput').value.trim();

            if (!reason) {
                alert('请选择补充原因');
                return;
            }

            if (uploadedFiles.plan.length === 0) {
                alert('请上传补充装修方案');
                return;
            }

            if (!confirm('确认提交补充装修方案？')) {
                return;
            }

            // 模拟提交
            document.getElementById('successModal').style.display = 'flex';
        }

        // 关闭弹窗
        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
        }

        // 返回详情页
        function goToDetail() {
            window.location.href = 'detail.html';
        }
    </script>
</body>
</html>
